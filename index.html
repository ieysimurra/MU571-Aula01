import React, { useState, useEffect } from 'react';
import { 
  BookOpen, 
  Layers, 
  Music, 
  Cpu, 
  Activity, 
  ArrowRight, 
  ChevronDown, 
  ChevronUp, 
  Terminal, 
  Play, 
  Disc, 
  X, 
  Youtube, 
  Info, 
  Volume2, 
  Mic2,
  List
} from 'lucide-react';

const CourseIntroApp = () => {
  const [activeTab, setActiveTab] = useState('repertoire');
  const [expandedModule, setExpandedModule] = useState(null);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

  const toggleModule = (index) => {
    setExpandedModule(expandedModule === index ? null : index);
  };

  const renderContent = () => {
    switch (activeTab) {
      case 'overview': return <OverviewSection />;
      case 'modules': return <ModulesSection expandedModule={expandedModule} toggleModule={toggleModule} />;
      case 'concepts': return <ConceptsSection />;
      case 'repertoire': return <RepertoireSection />;
      case 'tools': return <ToolsSection />;
      default: return <OverviewSection />;
    }
  };

  return (
    <div className="min-h-screen bg-gray-950 text-gray-100 font-sans selection:bg-cyan-900 pb-12">
      {/* Header */}
      <header className="bg-gray-900/95 backdrop-blur-md border-b border-gray-800 p-4 sticky top-0 z-30 shadow-2xl">
        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
          <div className="flex items-center justify-between w-full md:w-auto">
            <div>
              <h1 className="text-2xl md:text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500 tracking-tight">
                Composição IV
              </h1>
              <p className="text-gray-400 text-xs md:text-sm mt-0.5 font-medium">Tecnomorfismo & Escrita Pós-Digital</p>
            </div>
            
            {/* Mobile Menu Button */}
            <button 
              className="md:hidden text-gray-400 hover:text-white"
              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
            >
              <List size={24} />
            </button>
          </div>

          <div className="hidden md:flex items-center gap-3">
             <div className="px-3 py-1 bg-cyan-950/50 rounded border border-cyan-800 text-xs font-mono text-cyan-400">
              Aula 00
            </div>
            <div className="px-3 py-1 bg-purple-950/50 rounded border border-purple-800 text-xs font-mono text-purple-400">
              Pós-Graduação
            </div>
          </div>
        </div>
        
        {/* Mobile Navigation Dropdown */}
        {isMobileMenuOpen && (
          <div className="md:hidden mt-4 border-t border-gray-800 pt-2 animate-fadeIn">
            <nav className="flex flex-col gap-2">
              <MobileNavItem id="overview" label="Visão Geral" icon={<Activity size={16} />} activeTab={activeTab} setActiveTab={(t) => {setActiveTab(t); setIsMobileMenuOpen(false)}} />
              <MobileNavItem id="modules" label="Arco do Curso" icon={<Layers size={16} />} activeTab={activeTab} setActiveTab={(t) => {setActiveTab(t); setIsMobileMenuOpen(false)}} />
              <MobileNavItem id="concepts" label="Conceitos" icon={<Cpu size={16} />} activeTab={activeTab} setActiveTab={(t) => {setActiveTab(t); setIsMobileMenuOpen(false)}} />
              <MobileNavItem id="repertoire" label="Repertório" icon={<Music size={16} />} activeTab={activeTab} setActiveTab={(t) => {setActiveTab(t); setIsMobileMenuOpen(false)}} highlight />
              <MobileNavItem id="tools" label="Ferramentas" icon={<Terminal size={16} />} activeTab={activeTab} setActiveTab={(t) => {setActiveTab(t); setIsMobileMenuOpen(false)}} />
            </nav>
          </div>
        )}
      </header>

      <main className="max-w-7xl mx-auto p-4 md:p-6 flex flex-col lg:flex-row gap-6 mt-4">
        {/* Desktop Sidebar Navigation */}
        <nav className="hidden lg:block w-64 flex-shrink-0 z-10">
          <div className="bg-gray-900 rounded-xl p-4 sticky top-32 border border-gray-800 shadow-xl">
            <ul className="space-y-2">
              <NavItem id="overview" label="Visão Geral" icon={<Activity size={18} />} activeTab={activeTab} setActiveTab={setActiveTab} />
              <NavItem id="modules" label="Arco do Curso" icon={<Layers size={18} />} activeTab={activeTab} setActiveTab={setActiveTab} />
              <NavItem id="concepts" label="Conceitos" icon={<Cpu size={18} />} activeTab={activeTab} setActiveTab={setActiveTab} />
              <NavItem id="repertoire" label="Repertório & Player" icon={<Music size={18} />} activeTab={activeTab} setActiveTab={setActiveTab} highlight={true} />
              <NavItem id="tools" label="Ferramentas" icon={<Terminal size={18} />} activeTab={activeTab} setActiveTab={setActiveTab} />
            </ul>
          </div>
        </nav>

        {/* Main Content Area */}
        <div className="flex-grow min-w-0">
          <div className="bg-gray-900 rounded-xl border border-gray-800 p-4 md:p-8 shadow-2xl min-h-[600px] relative overflow-hidden">
            {/* Background decorative element */}
            <div className="absolute top-0 right-0 w-64 h-64 bg-cyan-500/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>
            {renderContent()}
          </div>
        </div>
      </main>
    </div>
  );
};

// --- REPERTOIRE SECTION WITH INTEGRATED PLAYER ---

const RepertoireSection = () => {
  const [filter, setFilter] = useState('all');
  const [activeVideo, setActiveVideo] = useState(null);

  // Helper to extract YouTube ID accurately
  const getYoutubeId = (url) => {
    if (!url) return null;
    const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
    const match = url.match(regExp);
    return (match && match[2].length === 11) ? match[2] : null;
  };

  const handlePlay = (work, link) => {
    const videoId = getYoutubeId(link.url);
    if (videoId) {
      const newVideo = { ...work, videoId, url: link.url };
      setActiveVideo(newVideo);
      // Smooth scroll to top on mobile to see player
      if (window.innerWidth < 1024) {
        window.scrollTo({ top: 100, behavior: 'smooth' });
      }
    } else {
      window.open(link.url, '_blank');
    }
  };

  // Data Source based on your syllabus
  const repertoireData = [
    {
      module: "Módulo 1: Paradigma Espectral",
      color: "border-blue-500",
      bgHover: "hover:bg-blue-900/10",
      works: [
        {
          composer: "Gérard Grisey",
          title: "Partiels",
          year: "1975",
          desc: "Análise do espectro do trombone orquestrado. A 'Síntese Aditiva Instrumental'.",
          links: [
            { label: "Ensemble Court-circuit", url: "https://www.youtube.com/watch?v=1QLICwmOtjc" },
            { label: "Análise Visual", url: "https://www.youtube.com/watch?v=2LAtJHFJuog" }
          ]
        },
        {
          composer: "Gérard Grisey",
          title: "Vortex Temporum",
          year: "1996",
          desc: "Mimese de formas de onda (senoidal, quadrada, serra) via arpejos e trinados.",
          links: [
            { label: "Performance BCMG", url: "https://www.youtube.com/watch?v=70xJ0Sdc2G8" },
            { label: "Áudio + Partitura", url: "https://www.youtube.com/watch?v=f_CkCypPFAQ" }
          ]
        },
        {
          composer: "Tristan Murail",
          title: "Gondwana",
          year: "1980",
          desc: "Simulação de FM (Frequência Modulada) orquestral. Interpolação sino-trombone.",
          links: [
            { label: "Ouvir Obra", url: "https://www.youtube.com/watch?v=uaPVaPPDmVs" }
          ]
        }
      ]
    },
    {
      module: "Módulo 2: Granularidade & Textura",
      color: "border-green-500",
      bgHover: "hover:bg-green-900/10",
      works: [
        {
          composer: "Iannis Xenakis",
          title: "Metastaseis",
          year: "1954",
          desc: "Precursor da granularidade. Glissandi massivos criando superfícies estocásticas.",
          links: [
            { label: "Visualização Espectral", url: "https://www.youtube.com/watch?v=u81IGEFt7dM" },
            { label: "Partitura", url: "https://www.youtube.com/watch?v=SZazYFchLRI" }
          ]
        },
        {
          composer: "Silvio Ferraz",
          title: "Lamento Quase Mudo",
          year: "2000s",
          desc: "Violoncelo como gerador de ruído. Técnicas de fricção e sobrepressão.",
          links: [
            { label: "Performance", url: "https://www.youtube.com/watch?v=4gxmlRtXOiY" }
          ]
        },
        {
          composer: "Barry Truax",
          title: "Riverrun",
          year: "1986",
          desc: "Síntese Granular em tempo real. O som da água gerado bit a bit.",
          links: [
            { label: "Ouvir Obra", url: "https://www.youtube.com/watch?v=lP1mqsNEz-s" }
          ]
        }
      ]
    },
    {
      module: "Módulo 3: Tempo, Loop & Glitch",
      color: "border-purple-500",
      bgHover: "hover:bg-purple-900/10",
      works: [
        {
          composer: "Bernhard Lang",
          title: "Monadologie V",
          year: "2009",
          desc: "Estética do CD riscado (Loop Mecânico) aplicada ao piano acústico.",
          links: [
            { label: "Marino Formenti (Piano)", url: "https://www.youtube.com/watch?v=AJeuwpY3khw" }
          ]
        },
        {
          composer: "Stefan Prins",
          title: "Piano Hero #1",
          year: "2011",
          desc: "O músico como avatar. Dissociação completa entre gesto físico e som.",
          links: [
            { label: "Performance Zubin Kanga", url: "https://www.youtube.com/watch?v=vB7mHSxlE3g" }
          ]
        },
        {
          composer: "Flo Menezes",
          title: "Parcours de l'Entité",
          year: "1994",
          desc: "Maximalismo. A densidade da escrita instrumental compete com a eletrônica.",
          links: [
            { label: "Ouvir Obra", url: "https://www.youtube.com/watch?v=3fizz1wIPko" }
          ]
        }
      ]
    },
    {
      module: "Módulo 4: Percussão & Corpo",
      color: "border-red-500",
      bgHover: "hover:bg-red-900/10",
      works: [
        {
          composer: "Helmut Lachenmann",
          title: "Pression",
          year: "1969",
          desc: "Musique concrète instrumentale. O corpo do instrumento como território.",
          links: [
            { label: "Lucas Fels (Cello)", url: "https://www.youtube.com/watch?v=aeF6W9M8aBo" }
          ]
        },
        {
          composer: "Cesar Traldi",
          title: "Cambucá",
          year: "2000s",
          desc: "Percussão múltipla brasileira. Interpretação mediada por suporte fixo.",
          links: [
            { label: "Performance", url: "https://www.youtube.com/watch?v=aeF6W9M8aBo" }
          ]
        }
      ]
    },
    {
      module: "Popular, Eletrônica & Híbridos",
      color: "border-yellow-500",
      bgHover: "hover:bg-yellow-900/10",
      works: [
        {
          composer: "Aphex Twin",
          title: "Estética Glitch",
          year: "Vários",
          desc: "Uso de síntese granular para criar percussão fragmentada e IDM.",
          links: [
            { label: "Tutorial de Estilo", url: "https://www.youtube.com/watch?v=wSRi1q30og8" }
          ]
        },
        {
          composer: "Anitta / Prod. Gabriel do Borel",
          title: "Funk Generation",
          year: "2024",
          desc: "Hibridização Funk Carioca + EDM. Tecnomorfismo cultural globalizado.",
          links: [
            { label: "Funk Rave (Video)", url: "https://www.youtube.com/watch?v=SXFn-m7c5vY" }
          ]
        },
        {
          composer: "SOPHIE",
          title: "Hyperpop Sound Design",
          year: "2015+",
          desc: "Distorção extrema usada como ferramenta de síntese tímbrica.",
          links: [
            { label: "Análise de Produção", url: "https://www.youtube.com/watch?v=jGc61a9fPGo" }
          ]
        },
        {
          composer: "Arca",
          title: "Mutant",
          year: "2015",
          desc: "A falha e a granulação como estética de corpo híbrido.",
          links: [
            { label: "Análise Sonora", url: "https://www.youtube.com/watch?v=fEzzZUUEvSk" }
          ]
        }
      ]
    }
  ];

  return (
    <div className="flex flex-col lg:flex-row gap-6 h-full animate-fadeIn">
      {/* Lista de Obras (Coluna Esquerda) */}
      <div className={`flex-1 space-y-6 transition-all duration-500 ${activeVideo ? 'lg:w-1/2' : 'w-full'}`}>
        <div>
          <h2 className="text-2xl font-bold text-cyan-400 mb-2">Repertório de Estudo</h2>
          <p className="text-gray-400 text-sm mb-4">
            Clique nos links para carregar o vídeo no player.
          </p>
          
          <div className="flex gap-2 overflow-x-auto pb-2 mb-4 scrollbar-hide">
            {['all', 'Módulo 1', 'Módulo 2', 'Módulo 3', 'Módulo 4', 'Popular'].map(f => (
              <button
                key={f}
                onClick={() => setFilter(f)}
                className={`px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all ${
                  (filter === f || (f === 'all' && filter === 'all'))
                   ? 'bg-cyan-600 text-white shadow-lg shadow-cyan-900/50'
                    : 'bg-gray-800 text-gray-400 hover:bg-gray-700'
                }`}
              >
                {f === 'all' ? 'Ver Todos' : f.replace('Módulo ', 'Mód ')}
              </button>
            ))}
          </div>
        </div>

        <div className="space-y-6 overflow-y-auto max-h-[800px] pr-2 custom-scrollbar">
          {repertoireData.map((section, idx) => {
             if (filter !== 'all' && !section.module.includes(filter) && !(filter === 'Popular' && section.module.includes('Popular'))) return null;
             
             return (
              <div key={idx} className={`border-l-2 ${section.color} pl-4 animate-slideIn`}>
                <h3 className="text-lg font-bold text-gray-200 mb-3 flex items-center gap-2">
                  {section.module}
                </h3>
                <div className="grid gap-3">
                  {section.works.map((work, wIdx) => (
                    <div 
                      key={wIdx} 
                      className={`group bg-gray-800/40 p-3 rounded-lg border border-gray-700 hover:border-cyan-500/50 transition-all ${activeVideo?.title === work.title ? 'bg-cyan-900/10 border-cyan-500/50 ring-1 ring-cyan-500/30' : ''}`}
                    >
                      <div className="flex justify-between items-start mb-1">
                        <div>
                          <h4 className={`font-bold text-sm ${activeVideo?.title === work.title ? 'text-cyan-300' : 'text-gray-100'}`}>
                            {work.title}
                          </h4>
                          <span className="text-xs text-gray-400 font-medium">{work.composer}</span>
                        </div>
                        <span className="text-[10px] font-mono text-gray-500 bg-gray-900 px-1.5 py-0.5 rounded border border-gray-800">{work.year}</span>
                      </div>
                      <p className="text-xs text-gray-400 mt-1 mb-3 leading-relaxed">{work.desc}</p>
                      <div className="flex flex-wrap gap-2">
                        {work.links.map((link, lIdx) => (
                          <button
                            key={lIdx}
                            onClick={(e) => { e.stopPropagation(); handlePlay(work, link); }}
                            className="flex items-center gap-1.5 px-2.5 py-1.5 bg-gray-900 hover:bg-cyan-600 hover:text-white text-gray-300 rounded text-xs transition-colors border border-gray-700 hover:border-cyan-500"
                          >
                            <Play size={10} className="fill-current" />
                            {link.label}
                          </button>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      </div>

      {/* Player de Vídeo (Coluna Direita ou Modal Mobile) */}
      <div className={`lg:w-1/2 transition-all duration-500 ease-in-out ${activeVideo ? 'opacity-100 translate-x-0' : 'opacity-0 translate-x-10 hidden lg:block lg:w-0'}`}>
        <div className="sticky top-6 bg-gray-900 rounded-xl overflow-hidden border border-gray-700 shadow-2xl ring-1 ring-white/10">
          {activeVideo ? (
            <>
              <div className="bg-gray-800 p-3 flex justify-between items-center border-b border-gray-700">
                <div className="flex items-center gap-2.5">
                   <span className="relative flex h-2.5 w-2.5">
                      <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                      <span className="relative inline-flex rounded-full h-2.5 w-2.5 bg-red-500"></span>
                    </span>
                   <span className="text-xs font-bold text-gray-200 uppercase tracking-wider">Reproduzindo Agora</span>
                </div>
                <button 
                  onClick={() => setActiveVideo(null)} 
                  className="text-gray-400 hover:text-white hover:bg-gray-700 p-1 rounded transition-colors"
                >
                  <X size={18} />
                </button>
              </div>
              <div className="relative pt-[56.25%] bg-black group">
                <iframe
                  src={`https://www.youtube.com/embed/${activeVideo.videoId}?autoplay=1`}
                  className="absolute top-0 left-0 w-full h-full"
                  title={activeVideo.title}
                  frameBorder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowFullScreen
                ></iframe>
              </div>
              <div className="p-5">
                <div className="flex items-start justify-between mb-2">
                    <h3 className="font-bold text-xl text-cyan-400 leading-tight">{activeVideo.title}</h3>
                </div>
                <p className="text-sm font-medium text-gray-300 mb-4">{activeVideo.composer}</p>
                
                <div className="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                    <h4 className="text-xs uppercase font-bold text-gray-500 mb-2 flex items-center gap-2">
                        <Info size={12} /> Contexto Tecnomórfico
                    </h4>
                    <p className="text-sm text-gray-300 leading-relaxed">{activeVideo.desc}</p>
                </div>

                <div className="mt-4 flex gap-2">
                    <div className="text-xs text-gray-500 flex items-center gap-1 bg-gray-900 px-2 py-1 rounded">
                        <Volume2 size={12} />
                        Áudio
                    </div>
                    <div className="text-xs text-gray-500 flex items-center gap-1 bg-gray-900 px-2 py-1 rounded">
                        <Mic2 size={12} />
                        Análise Espectral
                    </div>
                </div>
              </div>
            </>
          ) : (
            <div className="h-96 flex flex-col items-center justify-center text-gray-500 p-8 text-center bg-gray-900/50">
              <Youtube size={64} className="mb-4 opacity-20" />
              <h3 className="text-lg font-medium text-gray-400">Player de Estudo</h3>
              <p className="text-sm max-w-xs mt-2 opacity-60">Selecione um exemplo na lista à esquerda para carregar a análise e o áudio correspondente.</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

// --- SUB-SEÇÕES DE CONTEÚDO ---

const OverviewSection = () => (
  <div className="space-y-8 animate-fadeIn max-w-4xl">
    <div>
      <h2 className="text-2xl font-bold text-cyan-400 mb-4 border-b border-gray-800 pb-2">A Premissa do Curso</h2>
      <p className="text-lg leading-relaxed text-gray-300">
        O objetivo deste curso não é ensinar a usar o computador para compor, mas sim entender como o computador <span className="text-white font-semibold italic">já reescreveu</span> a maneira como ouvimos e escrevemos para instrumentos acústicos.
      </p>
      <div className="mt-6 p-6 bg-gray-800/50 rounded-lg border-l-4 border-cyan-500 shadow-lg">
        <p className="text-xl font-light italic text-gray-200">
          "O tecnomorfismo é a internalização da máquina pelo humano."
        </p>
      </div>
    </div>

    <div>
      <h3 className="text-xl font-bold text-blue-400 mb-6 flex items-center gap-2">
        <BookOpen size={20} /> A Analogia Central: O Espelho Digital
      </h3>
      <div className="grid md:grid-cols-2 gap-6">
        <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 hover:border-gray-600 transition-colors">
          <h4 className="font-bold text-white mb-2 flex items-center gap-2">
            <span className="w-2 h-2 rounded-full bg-gray-500"></span> Séculos Passados
          </h4>
          <p className="text-sm text-gray-400 leading-relaxed">
            A música instrumental olhava para a <strong>Natureza</strong> (pássaros, trovões) ou para a <strong>Linguagem</strong> (retórica) em busca de modelos. O instrumento era uma extensão da voz ou do cenário.
          </p>
        </div>
        <div className="bg-gradient-to-br from-cyan-900/20 to-blue-900/20 p-6 rounded-xl border border-cyan-800 relative overflow-hidden group hover:border-cyan-600 transition-all">
          <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
            <Cpu size={80} />
          </div>
          <h4 className="font-bold text-cyan-300 mb-2 flex items-center gap-2">
            <span className="w-2 h-2 rounded-full bg-cyan-400 shadow-[0_0_10px_rgba(34,211,238,0.8)]"></span> Século XX / XXI
          </h4>
          <p className="text-sm text-gray-300 leading-relaxed relative z-10">
            O instrumento acústico olha para o <strong>Espelho Digital</strong>. Ele vê uma imagem granulada, filtrada, editada e processada. O objetivo é fazer a orquestra soar como um <em>delay</em>, um <em>glitch</em> ou um sintetizador.
          </p>
        </div>
      </div>
    </div>
  </div>
);

const ModulesSection = ({ expandedModule, toggleModule }) => {
  const modules = [
    {
      weeks: "Semanas 1-3",
      title: "O Alicerce Filosófico",
      subtitle: "Simondon, Transdução e Tipomorfologia",
      content: "A Transdução como operação de conversão de energia. Revisão da Tipomorfologia de Pierre Schaeffer (massa, grão, allure). A escuta reduzida como ferramenta analítica para texturas instrumentais."
    },
    {
      weeks: "Semanas 4-6",
      title: "A Microcirurgia do Timbre",
      subtitle: "Espectralismo e Síntese Instrumental",
      content: "Análise de espectro (FFT) e orquestração de parciais. Síntese Aditiva Instrumental (modelos de Grisey e Murail). Síntese Subtrativa e escultura de ruído através de técnicas estendidas."
    },
    {
      weeks: "Semanas 7-9",
      title: "O Tempo Pós-Digital",
      subtitle: "Granulação, Loop e Glitch",
      content: "Síntese Granular e Concatenativa (CSS) como modelos de escrita orquestral. A estética do Loop (repetição mecânica) e do Glitch (erro digital) na música acústica."
    },
    {
      weeks: "Semanas 10-12",
      title: "O Corpo e a Máquina",
      subtitle: "Percussão, Performance e Maximalismo",
      content: "Percussão como sintetizador de ruído branco. O corpo do intérprete como controlador/avatar (Stefan Prins). Maximalismo e densidade informacional (Flo Menezes)."
    },
    {
      weeks: "Semanas 13-15",
      title: "As Novas Fronteiras",
      subtitle: "Biomoformismo e Improvisação",
      content: "Biomoformismo: tecnologia modelando a natureza (Patricia Alessandrini). Crítica ao especismo. Improvisação livre mediada por sistemas de escuta de máquina."
    }
  ];

  return (
    <div className="space-y-6 max-w-4xl">
      <h2 className="text-2xl font-bold text-cyan-400 mb-6 flex items-center gap-2">
        <Layers size={24}/> Arco do Curso
      </h2>
      <div className="relative border-l-2 border-gray-800 ml-3 space-y-6">
        {modules.map((mod, idx) => (
          <div key={idx} className="ml-6 relative">
            <div className={`absolute -left-[33px] top-6 w-4 h-4 rounded-full border-4 border-gray-900 ${expandedModule === idx ? 'bg-cyan-500 shadow-[0_0_15px_rgba(6,182,212,0.6)]' : 'bg-gray-700'} transition-all duration-300`}></div>
            <div 
              className={`bg-gray-800/40 rounded-xl border ${expandedModule === idx ? 'border-cyan-700 bg-gray-800' : 'border-gray-700'} overflow-hidden cursor-pointer transition-all duration-300 hover:border-gray-600 group`}
              onClick={() => toggleModule(idx)}
            >
              <div className="p-5 flex justify-between items-center">
                <div>
                  <span className={`text-xs font-mono mb-1 block transition-colors ${expandedModule === idx ? 'text-cyan-400' : 'text-gray-500'}`}>{mod.weeks}</span>
                  <h3 className="font-bold text-lg text-gray-100 group-hover:text-cyan-200 transition-colors">{mod.title}</h3>
                  <p className="text-sm text-gray-400">{mod.subtitle}</p>
                </div>
                {expandedModule === idx ? <ChevronUp className="text-cyan-400" /> : <ChevronDown className="text-gray-600 group-hover:text-gray-400" />}
              </div>
              
              {expandedModule === idx && (
                <div className="px-5 pb-5 pt-0 text-gray-300 text-sm border-t border-gray-700/50 mt-2 pt-4 animate-fadeIn">
                  <p className="leading-relaxed">{mod.content}</p>
                </div>
              )}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

const ConceptsSection = () => (
  <div className="space-y-6">
    <h2 className="text-2xl font-bold text-cyan-400 mb-6 flex items-center gap-2">
      <Cpu size={24}/> Conceitos Fundamentais
    </h2>
    <div className="grid md:grid-cols-2 gap-6">
      <ConceptCard 
        title="Tecnomorfismo" 
        def="Techne + Morphe" 
        desc="Uso metafórico de processos tecnológicos em meios acústicos. Não é usar um computador, é pensar como um." 
      />
      <ConceptCard 
        title="Transdução" 
        def="Gilbert Simondon" 
        desc="Passagem de informação entre domínios heterogêneos. O compositor converte lógica digital em energia acústica." 
      />
      <ConceptCard 
        title="Escuta Reduzida" 
        def="Pierre Schaeffer" 
        desc="Ouvir a morfologia (massa, grão, allure) ignorando a causa do som. Essencial para analisar texturas complexas." 
      />
      <ConceptCard 
        title="Simulativo vs Metafórico" 
        def="Holmes / Catanzaro" 
        desc="Simulativo: Imitar a superfície sonora (ex: ruído branco). Metafórico: Imitar a lógica estrutural (ex: loop, corte)." 
      />
    </div>
  </div>
);

const ConceptCard = ({ title, def, desc }) => (
  <div className="bg-gray-800/50 p-6 rounded-xl border-l-4 border-purple-500 hover:bg-gray-800 transition-all hover:translate-x-1">
    <div className="flex justify-between items-start mb-2">
        <h3 className="font-bold text-xl text-white">{title}</h3>
        <Cpu size={16} className="text-purple-500 opacity-50"/>
    </div>
    <span className="text-xs uppercase tracking-wider text-purple-400 font-mono mb-3 block">{def}</span>
    <p className="text-sm text-gray-300 leading-relaxed">{desc}</p>
  </div>
);

const ToolsSection = () => (
  <div className="space-y-8 max-w-4xl">
    <div>
      <h2 className="text-2xl font-bold text-cyan-400 mb-6 flex items-center gap-2">
        <Terminal size={24}/> Ferramentas & Diagnóstico
      </h2>
      <div className="grid md:grid-cols-2 gap-4 mb-8">
        <div className="bg-gray-800 p-5 rounded-xl border border-gray-700 flex items-start gap-4">
          <div className="p-3 bg-gray-900 rounded-lg text-cyan-400">
            <Activity size={24} />
          </div>
          <div>
            <h3 className="font-bold text-white mb-1">Sonic Visualiser</h3>
            <p className="text-sm text-gray-400">Software para ver o som. Analisaremos espectrogramas para entender o "grão" e a "massa" interna.</p>
          </div>
        </div>
        <div className="bg-gray-800 p-5 rounded-xl border border-gray-700 flex items-start gap-4">
          <div className="p-3 bg-gray-900 rounded-lg text-purple-400">
            <Layers size={24} />
          </div>
          <div>
            <h3 className="font-bold text-white mb-1">Lógica DSP</h3>
            <p className="text-sm text-gray-400">Conceitos de processamento de sinal: Filtros (Low-Pass), Envelope Follower, Delay Lines.</p>
          </div>
        </div>
      </div>
    </div>
    
    <div className="bg-gradient-to-r from-gray-800 to-gray-900 p-8 rounded-xl border border-gray-700 shadow-lg">
      <h3 className="text-xl font-bold text-white mb-6">Diagnóstico Inicial da Turma</h3>
      <div className="space-y-4">
        <div className="flex gap-4">
            <span className="flex-shrink-0 w-8 h-8 rounded-full bg-cyan-900/50 border border-cyan-700 text-cyan-400 flex items-center justify-center font-bold text-sm">1</span>
            <p className="text-gray-300 text-sm md:text-base pt-1">Você já tentou transcrever um som eletrônico para seu instrumento? Qual foi a maior dificuldade (timbre, sustentação)?</p>
        </div>
        <div className="flex gap-4">
            <span className="flex-shrink-0 w-8 h-8 rounded-full bg-cyan-900/50 border border-cyan-700 text-cyan-400 flex items-center justify-center font-bold text-sm">2</span>
            <p className="text-gray-300 text-sm md:text-base pt-1">Quais compositores brasileiros você associa imediatamente ao uso de tecnologia na escrita?</p>
        </div>
      </div>
    </div>
  </div>
);

// --- COMPONENTES UI AUXILIARES ---

const NavItem = ({ id, label, icon, activeTab, setActiveTab, highlight }) => (
  <li>
    <button
      onClick={() => setActiveTab(id)}
      className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 group ${
        activeTab === id 
         ? 'bg-cyan-600 text-white shadow-lg shadow-cyan-900/20' 
          : highlight 
            ? 'bg-gray-800 text-cyan-400 border border-cyan-900/30 hover:border-cyan-500/50'
            : 'text-gray-400 hover:bg-gray-800 hover:text-white'
      }`}
    >
      <span className={activeTab === id ? 'text-white' : highlight ? 'text-cyan-400' : 'text-gray-500 group-hover:text-white transition-colors'}>
        {icon}
      </span>
      <span className="text-sm font-medium">{label}</span>
      {activeTab === id && <ArrowRight size={14} className="ml-auto animate-pulse" />}
    </button>
  </li>
);

const MobileNavItem = ({ id, label, icon, activeTab, setActiveTab, highlight }) => (
  <button
    onClick={() => setActiveTab(id)}
    className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${
      activeTab === id 
        ? 'bg-cyan-600 text-white' 
        : 'text-gray-300 hover:bg-gray-800'
    }`}
  >
    {icon}
    <span className="text-sm font-medium">{label}</span>
  </button>
);

export default CourseIntroApp;
